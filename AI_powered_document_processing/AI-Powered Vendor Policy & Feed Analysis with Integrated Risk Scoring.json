{
  "name": "AI-Powered Vendor Policy & Feed Analysis with Integrated Risk Scoring",
  "nodes": [
    {
      "parameters": {
        "url": "={{ $json.feedUrl }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "id": "8173ba8c-2eb6-4976-ad62-b92b04ccd4e2",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2000,
        1152
      ],
      "notesInFlow": true,
      "typeVersion": 4.2,
      "alwaysOutputData": false,
      "notes": "ðŸŒ Requests vendor policy pages for content inspection."
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.entries }}",
        "options": {
          "systemMessage": "=Vendor Risk & Compliance Digest Prompt\n\nAI Agent Role: You are a Senior Compliance & Risk Intelligence Analyst embedded in an automation workflow. Your job is to analyze compliance-related content from vendor feeds and produce structured, actionable summaries for use by compliance, security, and executive teams. Dont Halucinate, Dont add any new news, only act on the provided data\n\nðŸ§¾ Input Format\n\nYou will receive a single JSON object containing an array of items. Each item is structured as:\n\n{\n  \"Title\": \"...\",\n  \"Vendor Name\": \"...\",\n  \"link\": \"https://â€¦\",\n  \"content\": \"Snippet or article content here\"\n}\n\nðŸ§  Instructions\n\nDeduplicate entries by the link field.\n\nFor each unique item:\n\nAssign a Risk Rating:\n\nHigh\n\nMedium\n\nLow\n\nInformational\n\nWrite a 2-sentence summary from a compliance, risk, or security standpoint.\n\nGroup the output by the risk level in a single JSON object.\n\nOmit any empty groups (i.e., risk levels with no entries).\n\nDo not include extra prose, HTML, Markdown, or escape characters.\n\nâœ… Output Format\n\nRespond with only this structure:\n\n{\n  \"High\": [\n    { \"summary\": \"...\", \"link\": \"https://...\", \"Title\": \"...\",\"Vendor Name\": \"...\" }\n  ],\n  \"Medium\": [ ... ],\n  \"Low\": [ ... ],\n  \"Informational\": [ ... ]\n}\n\nThis output will be used by downstream code to generate an HTML email digest.",
          "passthroughBinaryImages": false
        }
      },
      "id": "b949f6e9-9e15-4af1-82b8-66f199492cd4",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        2896,
        480
      ],
      "notesInFlow": true,
      "typeVersion": 2,
      "alwaysOutputData": false,
      "notes": "ðŸ¤– Analyzes grouped RSS feeds and categorizes risks using structured JSON."
    },
    {
      "parameters": {
        "jsCode": "const feeds = [\n  { name: 'TechCrunch',    feedUrl: 'https://techcrunch.com/feed/' },\n  { name: 'The Verge',     feedUrl: 'https://www.theverge.com/rss/index.xml' },\n  { name: 'SmashingMag',    feedUrl: 'https://www.smashingmagazine.com/feed/' },\n];\n\n// 2) Transform into n8n-compatible output\nreturn feeds.map(feed => ({\n  json: {\n    name:    feed.name,\n    feedUrl: feed.feedUrl,\n  }\n}));"
      },
      "id": "29968cfd-a63c-4628-bd55-6ef6fd9ceaf9",
      "name": "RSS Feed List",
      "type": "n8n-nodes-base.code",
      "position": [
        1584,
        560
      ],
      "executeOnce": true,
      "notesInFlow": true,
      "typeVersion": 2,
      "notes": "ðŸ“° Provide a list of RSS feeds (Security, Privacy, Compliance). Customize URLs as needed."
    },
    {
      "parameters": {
        "fieldToSplitOut": "feedUrl",
        "options": {}
      },
      "id": "842235bc-d1a3-4ff5-84ab-73d7219ac3cd",
      "name": "Splitting the Feeds",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        1808,
        560
      ],
      "notesInFlow": true,
      "typeVersion": 1,
      "notes": "ðŸ”€ Split RSS list so each feed can be fetched individually."
    },
    {
      "parameters": {
        "url": "={{ $json.feedUrl }}",
        "options": {}
      },
      "id": "142a70f0-6b0e-4a7d-9306-d6e1d398e8c9",
      "name": "Vendor RSS Feed Read",
      "type": "n8n-nodes-base.rssFeedRead",
      "position": [
        2032,
        560
      ],
      "notesInFlow": true,
      "typeVersion": 1.1,
      "notes": "ðŸ“¥ Reads RSS feed content per URL."
    },
    {
      "parameters": {
        "jsCode": "const feeds = [\n    \n  {\n  name: 'test', feedUrl:'https://www.ted.com/about/our-organization/our-policies-terms/privacy-policy'},\n  {name: 'test2', feedUrl: 'https://www.teamviewer.com/en-in/global/support/knowledge-base/teamviewer-remote/devices/policies/'},\n];\n\n// 2) Transform into n8n-compatible output\nreturn feeds.map(feed => ({\n  json: {\n    name:    feed.name,\n    feedUrl: feed.feedUrl,\n  }\n}));"
      },
      "id": "7c15b72b-41e0-4299-a73a-f97c625eab0f",
      "name": "Vendor URLs",
      "type": "n8n-nodes-base.code",
      "position": [
        1568,
        1152
      ],
      "notesInFlow": true,
      "typeVersion": 2,
      "notes": "ðŸŒ Provide a list of direct vendor policy webpage URLs to monitor updates."
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.content }} & {{ $json.url }}",
        "options": {
          "systemMessage": "You are a Senior Risk and Compliance Analyst.\n\nYour job is to:\n- Read the content and generate a short 2-line summary\n- Categorize the risk as one of: High, Medium, Low, Informational\n\nReturn a clean JSON like:\n{\n  \"summary\": \"...\",\n  \"risk\": \"Medium\",\n  \"title\": \"...\",\n  \"Vendor Name\": \"....\",\n  \"url\": \"...\"\n}\n\nInput:\nTitle: {{$json[\"title\"]}}\nLink: {{$json[\"link\"]}}\nContent: {{$json[\"content\"]}}\n",
          "passthroughBinaryImages": false
        }
      },
      "id": "b8446e25-4569-48b6-ab84-5ac0774b33ac",
      "name": "AI Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        3264,
        1152
      ],
      "notesInFlow": true,
      "typeVersion": 2,
      "alwaysOutputData": false,
      "notes": "ðŸ§  Summarizes individual webpage content into short risk summaries."
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-001",
        "options": {}
      },
      "id": "b112df25-76c7-4901-964f-5b2630a2bd59",
      "name": "Google Gemini Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        3280,
        1360
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "QwWmWL8Rm3D4JPmn",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "nsultana2021@icloud.com",
        "subject": "=Vendor Webpage Change  {{$now}}",
        "message": "={{ $json.html }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "0d646e5d-cddf-4af1-a0e0-50573b1c29f0",
      "name": "Gmail",
      "type": "n8n-nodes-base.gmail",
      "position": [
        3872,
        1152
      ],
      "webhookId": "d33f7afd-47c3-4616-9a37-6319d93c0e92",
      "notesInFlow": true,
      "typeVersion": 2.1,
      "credentials": {
        "gmailOAuth2": {
          "id": "YNg4hDlVnTtx6NIm",
          "name": "Gmail account"
        }
      },
      "notes": "ðŸ“¨ Sends summary email for webpage policy updates."
    },
    {
      "parameters": {
        "sendTo": "nsultana2021@icloud.com",
        "subject": "=Vendor RSS Feed Monitoring as on {{ $now }}",
        "message": "={{ $json.html }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "89022805-76bf-4441-97e4-123a8da3188f",
      "name": "Gmail1",
      "type": "n8n-nodes-base.gmail",
      "position": [
        3664,
        560
      ],
      "webhookId": "66d44179-c4aa-4acd-b61e-d91a1f888d9d",
      "notesInFlow": true,
      "typeVersion": 2.1,
      "credentials": {
        "gmailOAuth2": {
          "id": "YNg4hDlVnTtx6NIm",
          "name": "Gmail account"
        }
      },
      "notes": "ðŸ“§ Sends HTML newsletter summary email for RSS feeds."
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-001",
        "options": {}
      },
      "id": "b526c598-9a3d-4691-aa24-836670ed4431",
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        2912,
        688
      ],
      "typeVersion": 1,
      "credentials": {
        "googlePalmApi": {
          "id": "QwWmWL8Rm3D4JPmn",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "09fe1774-6a5a-4cf5-97c8-0afb7d44431e",
              "operator": {
                "type": "number",
                "operation": "gte"
              },
              "leftValue": "={{ new Date($json.isoDate).getTime() }}",
              "rightValue": "={{Date.now() - 24 * 60 * 60 * 1000 }}"
            },
            {
              "id": "93e97b32-40d7-4514-bc70-a7f51729b681",
              "operator": {
                "type": "number",
                "operation": "gte"
              },
              "leftValue": "={{ new Date($json.pubDate).getTime()}}",
              "rightValue": "={{ Date.now() - 24 * 60 * 60 * 1000 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "abff635e-8128-4714-b413-1d010a525284",
      "name": "Filtering last 24hrs feed",
      "type": "n8n-nodes-base.filter",
      "position": [
        2240,
        560
      ],
      "notesInFlow": true,
      "typeVersion": 2.2,
      "notes": "â³ Filters RSS articles published in the last 24 hours."
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\nlet combined = [];\n\nfor (const item of allItems) {\n  let rawOutput = item.json.output || '';\n\n  let cleaned = rawOutput\n    .replace(/^```json\\s*/, '')\n    .replace(/```$/, '')\n    .trim()\n    .replace(/,\\s*(\\]|\\})/g, '$1');\n\n  try {\n    const parsed = JSON.parse(cleaned);\n    for (const [riskLevel, entries] of Object.entries(parsed)) {\n      if (Array.isArray(entries)) {\n        entries.forEach(entry => {\n          combined.push({\n            risk: riskLevel,\n            summary: entry.summary,\n            link: entry.link,\n            title: entry.title || '',\n            vendor: entry['Vendor Name'] || ''\n          });\n        });\n      }\n    }\n  } catch (err) {\n    throw new Error(\"Invalid JSON in input item: \" + err.message);\n  }\n}\n\nconst riskData = { High: [], Medium: [], Low: [], Informational: [] };\ncombined.forEach(entry => {\n  const risk = entry.risk || 'Informational';\n  riskData[risk]?.push(entry);\n});\n\nconst categoryStyles = {\n  High: { color: '#f28b82', emoji: 'ðŸ”´' },\n  Medium: { color: '#fbbc04', emoji: 'ðŸŸ ' },\n  Low: { color: '#81c995', emoji: 'ðŸŸ¢' },\n  Informational: { color: '#a7c7e7', emoji: 'ðŸ”µ' }\n};\n\nlet html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n    body {\n      font-family: 'Inter', sans-serif;\n      background: #fff;\n      padding: 32px;\n      margin: 0;\n      color: #333;\n    }\n    .risk-heading {\n      font-size: 22px;\n      font-weight: 700;\n      margin: 30px 0 20px;\n      padding: 16px 24px;\n      border-radius: 16px;\n      color: #fff;\n      display: inline-block;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n    .card {\n      background: #fff;\n      border-left: 6px solid;\n      border-radius: 12px;\n      padding: 24px;\n      margin: 20px 0;\n      box-shadow: 0 1px 6px rgba(0,0,0,0.06);\n      max-width: 800px;\n    }\n    .vendor {\n      font-size: 18px;\n      font-weight: 700;\n      color: #111;\n      margin-bottom: 6px;\n    }\n    .title {\n      font-size: 15px;\n      font-weight: 600;\n      color: #444;\n      margin-bottom: 14px;\n    }\n    .summary {\n      font-size: 15px;\n      line-height: 1.6;\n      margin-bottom: 12px;\n    }\n    .read-more a {\n      font-size: 14px;\n      color: #1a73e8;\n      text-decoration: none;\n      font-weight: 500;\n    }\n    .read-more a:hover {\n      text-decoration: underline;\n    }\n  </style>\n</head>\n<body>\n`;\n\nfor (const [category, entries] of Object.entries(riskData)) {\n  if (entries.length === 0) continue;\n  const { color, emoji } = categoryStyles[category];\n  html += `<div class=\"risk-heading\" style=\"background-color: ${color};\">${emoji} ${category} Risk</div>`;\n  entries.forEach(item => {\n    html += `\n      <div class=\"card\" style=\"border-left-color: ${color};\">\n        <div class=\"vendor\">${item.vendor || 'â€”'}</div>\n        <div class=\"title\">${item.title || 'â€”'}</div>\n        <div class=\"summary\">${item.summary}</div>\n        <div class=\"read-more\"><a href=\"${item.link}\" target=\"_blank\" rel=\"noopener noreferrer\">Read more</a></div>\n      </div>\n    `;\n  });\n}\n\nhtml += `</body></html>`;\n\nreturn [{ json: { html } }];\n"
      },
      "id": "e7f8b311-7f9f-4b47-b824-2e6e233b4e07",
      "name": "Formatting the Content for Mail",
      "type": "n8n-nodes-base.code",
      "position": [
        3360,
        560
      ],
      "notesInFlow": true,
      "typeVersion": 2,
      "notes": "ðŸ’Œ Formats AI response as styled HTML grouped by risk category."
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "pubDate"
            }
          ]
        },
        "options": {}
      },
      "id": "876a538f-1256-4228-9e64-56d47d091953",
      "name": "Sort the feeds",
      "type": "n8n-nodes-base.sort",
      "position": [
        2464,
        560
      ],
      "notesInFlow": true,
      "typeVersion": 1,
      "notes": "ðŸ”ƒ Sort the RSS entries by pubDate for consistent order."
    },
    {
      "parameters": {
        "jsCode": "// Build an array of { link, content } pairs\nconst entries = items.map(item => ({\n  link:    item.json.link,\n  content: item.json.contentSnippet || item.json.content || \"\"\n}));\n\n// Return one item with a single field â€œentriesâ€\nreturn [\n  {\n    json: {\n      entries\n    }\n  }\n];\n"
      },
      "id": "63aa9981-f92e-4abb-a2ef-42468611dd9b",
      "name": "Merge the content for AI",
      "type": "n8n-nodes-base.code",
      "position": [
        2688,
        560
      ],
      "notesInFlow": true,
      "typeVersion": 2,
      "notes": "ðŸ§© Merges cleaned RSS entries into one payload for the AI agent."
    },
    {
      "parameters": {},
      "id": "99d2c5f3-8c80-4f9c-acf8-0b726fc72cc8",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "position": [
        2672,
        1152
      ],
      "notesInFlow": true,
      "typeVersion": 3.2,
      "notes": "ðŸ”€ Merge both page meta and body-based content analysis."
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\nlet combined = [];\n\nfor (const item of allItems) {\n  let rawOutput = item.json.output || '';\n\n  let cleaned = rawOutput\n    .replace(/^```json\\s*/, '')\n    .replace(/```$/, '')\n    .trim()\n    .replace(/,\\s*(\\]|\\})/g, '$1');\n\n  try {\n    const parsed = JSON.parse(cleaned);\n    if (Array.isArray(parsed)) {\n      combined.push(...parsed);\n    } else if (parsed && parsed.risk && parsed.summary) {\n      combined.push(parsed);\n    }\n  } catch (err) {\n    throw new Error(\"Invalid JSON in input item: \" + err.message);\n  }\n}\n\n// Group by risk\nlet riskData = {\n  High: [],\n  Medium: [],\n  Low: [],\n  Informational: []\n};\n\ncombined.forEach(entry => {\n  const risk = entry.risk || 'Informational';\n  riskData[risk]?.push(entry);\n});\n\nconst categoryStyles = {\n  High: { color: '#f28b82', emoji: 'ðŸ”´' },\n  Medium: { color: '#fbbc04', emoji: 'ðŸŸ ' },\n  Low: { color: '#81c995', emoji: 'ðŸŸ¢' },\n  Informational: { color: '#a7c7e7', emoji: 'ðŸ”µ' },\n};\n\nlet html = `\n<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n    body {\n      font-family: 'Inter', sans-serif;\n      background: #fff;\n      padding: 32px;\n      margin: 0;\n      color: #333;\n    }\n    .risk-heading {\n      font-size: 22px;\n      font-weight: 700;\n      margin: 30px 0 20px;\n      padding: 16px 24px;\n      border-radius: 16px;\n      color: #fff;\n      display: inline-block;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n    .card {\n      background: #fff;\n      border-left: 6px solid;\n      border-radius: 12px;\n      padding: 24px;\n      margin: 20px 0;\n      box-shadow: 0 1px 6px rgba(0,0,0,0.06);\n      max-width: 800px;\n    }\n    .vendor {\n      font-size: 18px;\n      font-weight: 700;\n      color: #111;\n      margin-bottom: 6px;\n    }\n    .title {\n      font-size: 15px;\n      font-weight: 600;\n      color: #444;\n      margin-bottom: 14px;\n    }\n    .summary {\n      font-size: 15px;\n      line-height: 1.6;\n      margin-bottom: 12px;\n    }\n    .read-more a {\n      font-size: 14px;\n      color: #1a73e8;\n      text-decoration: none;\n      font-weight: 500;\n    }\n    .read-more a:hover {\n      text-decoration: underline;\n    }\n  </style>\n</head>\n<body>\n`;\n\nfor (const [category, entries] of Object.entries(riskData)) {\n  if (entries.length === 0) continue;\n  const { color, emoji } = categoryStyles[category];\n  html += `<div class=\"risk-heading\" style=\"background-color: ${color};\">${emoji} ${category} Risk</div>`;\n  entries.forEach(item => {\n    html += `\n      <div class=\"card\" style=\"border-left-color: ${color};\">\n        <div class=\"vendor\">${item['Vendor Name'] || 'Vendor Unknown'}</div>\n        <div class=\"title\">${item.title || 'Untitled Update'}</div>\n        <div class=\"summary\">${item.summary}</div>\n        <div class=\"read-more\"><a href=\"${item.url || item.link}\" target=\"_blank\" rel=\"noopener noreferrer\">Read more</a></div>\n      </div>\n    `;\n  });\n}\n\nhtml += `</body></html>`;\n\nreturn [{ json: { html } }];\n"
      },
      "id": "72bd56db-5745-4db2-8810-3b0c862ef2f9",
      "name": "Format the Summary for Email",
      "type": "n8n-nodes-base.code",
      "position": [
        3648,
        1152
      ],
      "notesInFlow": true,
      "typeVersion": 2,
      "notes": "ðŸ§¾ Formats webpage summary output into email-ready HTML."
    },
    {
      "parameters": {
        "jsCode": "const now = new Date();\nconst results = [];\n\nconst datePatterns = [\n  /\\b(\\d{4}-\\d{2}-\\d{2}(?:[ T]\\d{2}:\\d{2}:\\d{2}(?:Z|[+\\-]\\d{2}:\\d{2})?)?)\\b/g,  // ISO + timezone\n  /\\b(\\d{4}\\/\\d{2}\\/\\d{2}(?:[ T]\\d{2}:\\d{2}:\\d{2})?)\\b/g,\n  /\\b(\\d{2}\\/\\d{2}\\/\\d{4}(?: \\d{2}:\\d{2}:\\d{2})?)\\b/g,\n  /\\b(\\d{2}\\.\\d{2}\\.\\d{4})\\b/g,\n  /\\b([A-Z][a-z]{2,8} \\d{1,2},? \\d{4})\\b/g,\n  /\\b(\\d{1,2} [A-Z][a-z]{2,8} \\d{4})\\b/g,\n  /\\b([A-Z][a-z]{2},? \\d{1,2} [A-Z][a-z]{2} \\d{4})\\b/g  // e.g., Fri, 20 Jun 2025\n];\n\nconst keywordRegex = /(updated|modified|published)/i;\nconst relativeRegex = /(updated|modified|published)[^\\d]{0,30}(today|yesterday)/i;\nconst keywordDateRegex = new RegExp(\n  `(updated|modified|published)[^\\\\dA-Z]{0,30}[:\\\\-\\\\s]*?(\\\\d{4}-\\\\d{2}-\\\\d{2}(?:[ T]\\\\d{2}:\\\\d{2}:\\\\d{2})?|\\\\d{2}\\\\/\\\\d{2}\\\\/\\\\d{4}|\\\\d{2}\\\\.\\\\d{2}\\\\.\\\\d{4}|[A-Z][a-z]{2,8} \\\\d{1,2},? \\\\d{4})`,\n  'i'\n);\n\nfor (const item of items) {\n  const content = item.json.data || \"\";\n  let found = false;\n  let matchedDate = null;\n  let matchedType = null;\n  let matchedKeyword = null;\n  let note = \"\";\n  let published = null;\n\n  // --- 1. Direct keyword-date detection (e.g. Updated: 2025-06-20)\n  const directMatch = content.match(keywordDateRegex);\n  if (directMatch) {\n    matchedKeyword = directMatch[1];\n    const dateStr = directMatch[2];\n    const parsedDate = new Date(dateStr);\n\n    if (!isNaN(parsedDate)) {\n      const isRecent = (() => {\n        const diffMs = now - parsedDate;\n        if (/\\d{2}:\\d{2}:\\d{2}/.test(dateStr)) {\n          return diffMs >= 0 && diffMs <= 24 * 60 * 60 * 1000;\n        } else {\n          const test = new Date(parsedDate); test.setHours(0,0,0,0);\n          const nowTrimmed = new Date(now); nowTrimmed.setHours(0,0,0,0);\n          const diffDays = (nowTrimmed - test) / (24 * 60 * 60 * 1000);\n          return diffDays === 0 || diffDays === 1;\n        }\n      })();\n\n      if (isRecent) {\n        found = true;\n        matchedDate = dateStr;\n        matchedType = /\\d{2}:\\d{2}:\\d{2}/.test(dateStr) ? \"datetime\" : \"date-only\";\n        note = `Found '${matchedKeyword}' with ${matchedType} \"${dateStr}\" (recent).`;\n      }\n    }\n  }\n\n  // --- 2. Relative phrases like \"Updated yesterday\"\n  if (!found) {\n    const relMatch = content.match(relativeRegex);\n    if (relMatch) {\n      matchedKeyword = relMatch[1];\n      const rel = relMatch[2].toLowerCase();\n      if (rel === \"today\" || rel === \"yesterday\") {\n        const refDate = new Date(now);\n        if (rel === \"yesterday\") refDate.setDate(refDate.getDate() - 1);\n        const isoDate = refDate.toISOString().split(\"T\")[0];\n        found = true;\n        matchedDate = isoDate;\n        matchedType = \"relative\";\n        note = `Found '${matchedKeyword}' with relative date \"${rel}\".`;\n      }\n    }\n  }\n\n  // --- 3. Fallback: Any keyword in proximity of any valid date\n  if (!found && keywordRegex.test(content)) {\n    for (const pat of datePatterns) {\n      pat.lastIndex = 0;\n      let dateMatch;\n      while ((dateMatch = pat.exec(content)) !== null) {\n        const dateStr = dateMatch[1];\n        const parsedDate = new Date(dateStr);\n        if (!isNaN(parsedDate)) {\n          const isTime = /\\d{2}:\\d{2}:\\d{2}/.test(dateStr);\n          const diff = isTime ? now - parsedDate : (() => {\n            const pd = new Date(parsedDate); pd.setHours(0,0,0,0);\n            const nd = new Date(now); nd.setHours(0,0,0,0);\n            return (nd - pd);\n          })();\n          const withinLimit = isTime ? diff >= 0 && diff <= 86400000 : (diff === 0 || diff === 86400000);\n          if (withinLimit) {\n            found = true;\n            matchedKeyword = \"generic-fallback\";\n            matchedDate = dateStr;\n            matchedType = isTime ? \"datetime\" : \"date-only\";\n            note = `Fallback: keyword present and found nearby date \"${dateStr}\" (recent).`;\n            break;\n          }\n        }\n      }\n      if (found) break;\n    }\n  }\n\n  // --- Extract published (non-filtering fallback)\n  if (!published) {\n    for (const pat of datePatterns) {\n      const match = pat.exec(content);\n      if (match && Date.parse(match[1])) {\n        published = match[1];\n        break;\n      }\n    }\n  }\n\n  // --- Return only matched results\n  if (!found) continue;\n\n  results.push({\n    json: {\n      keywordDetected: true,\n      matchedKeyword,\n      matchedDate,\n      matchedType,\n      published: published || \"Not available\",\n      note,\n      data: content\n    }\n  });\n}\n\nreturn results;\n"
      },
      "id": "46eb9297-514a-48a9-a6d7-a7868def9443",
      "name": "Scrapping inside the Webpage content",
      "type": "n8n-nodes-base.code",
      "position": [
        2464,
        1264
      ],
      "notesInFlow": true,
      "typeVersion": 2,
      "notes": "ðŸ” Inspects webpage HTML body to find 'update/modified' dates."
    },
    {
      "parameters": {
        "jsCode": "const items = [];\n\nfor (const item of $input.all()) {\n  const rawHtml = item.json.body || item.json.data || \"\";\n  let urlFromRequest = item.json.url || item.json.requestUrl || item.json.headers?.['x-final-url'] || '';\n\n  let html = rawHtml.toString();\n\n  // Try to extract canonical URL or og:url from HTML head\n  let extractedUrl = '';\n\n  const canonicalMatch = html.match(/<link[^>]+rel=[\"']canonical[\"'][^>]*href=[\"']([^\"']+)[\"']/i);\n  if (canonicalMatch) {\n    extractedUrl = canonicalMatch[1];\n  } else {\n    const ogUrlMatch = html.match(/<meta[^>]+property=[\"']og:url[\"'][^>]*content=[\"']([^\"']+)[\"']/i);\n    if (ogUrlMatch) {\n      extractedUrl = ogUrlMatch[1];\n    }\n  }\n\n  const finalUrl = extractedUrl || urlFromRequest;\n\n  // Strip scripts/styles/noscript/iframe/svg/etc.\n  html = html.replace(/<script[\\s\\S]*?>[\\s\\S]*?<\\/script>/gi, '');\n  html = html.replace(/<style[\\s\\S]*?>[\\s\\S]*?<\\/style>/gi, '');\n  html = html.replace(/<noscript[\\s\\S]*?>[\\s\\S]*?<\\/noscript>/gi, '');\n  html = html.replace(/<iframe[\\s\\S]*?>[\\s\\S]*?<\\/iframe>/gi, '');\n  html = html.replace(/<svg[\\s\\S]*?>[\\s\\S]*?<\\/svg>/gi, '');\n  html = html.replace(/<!--[\\s\\S]*?-->/g, '');\n  html = html.replace(/<\\/?[^>]+(>|$)/g, '');\n\n  // Decode HTML entities\n  html = html\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&quot;/g, '\"')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>');\n\n  // Clean whitespace\n  let content = html.replace(/\\s{2,}/g, ' ').trim();\n\n  // Limit size (safe for AI)\n  const maxLength = 30000;\n  if (content.length > maxLength) content = content.slice(0, maxLength) + '... [truncated]';\n\n  items.push({\n    json: {\n      url: finalUrl,\n      content\n    }\n  });\n}\n\nreturn items;\n"
      },
      "id": "d9f60170-f991-4d15-979f-4f2f6c6900f1",
      "name": "Cleaning up the code",
      "type": "n8n-nodes-base.code",
      "position": [
        2960,
        1152
      ],
      "notesInFlow": true,
      "typeVersion": 2,
      "notes": "ðŸ§¹ Cleans and strips raw HTML into readable content for AI processing."
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 3
            }
          ]
        }
      },
      "id": "dab07101-2f1a-4ef9-a492-b75ea866dcff",
      "name": "Daily Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        960,
        912
      ],
      "notesInFlow": true,
      "typeVersion": 1.2,
      "notes": "â° Triggers the workflow every day at 3 AM to initiate all newsletter jobs."
    },
    {
      "parameters": {
        "fieldToSplitOut": "feedUrl",
        "options": {}
      },
      "id": "ee5354b3-75a4-4a22-af17-08d8a3a1b94f",
      "name": "Splitting the Urls",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        1792,
        1152
      ],
      "notesInFlow": true,
      "typeVersion": 1,
      "notes": "ðŸ”€ Split array of vendor URLs to process them individually."
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "3cc0b4e8-e015-44fc-8118-ec7ec79dc2de",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              },
              "leftValue": "={{    Object.entries($json.headers).some(([key, val]) =>     /update|modified/i.test(key) &&     !isNaN(Date.parse(val)) &&     Date.parse(val) >= Date.now() - 24*60*60*1000   ) }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "f019c35a-9e4b-430a-a436-1ad3e177687a",
      "name": "Check the headers",
      "type": "n8n-nodes-base.if",
      "position": [
        2224,
        1152
      ],
      "notesInFlow": true,
      "typeVersion": 2.2,
      "notes": "ðŸ•µï¸â€â™‚ï¸ Checks vendor page headers for signs of recent updates (last modified)."
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all(); // Get all input items\nconst results = [];\n\nfor (const item of items) {\n  let jsonString = item.json.output;\n\n  // Clean the markdown code fences if present\n  jsonString = jsonString.replace(/```json|```/g, '').trim();\n\n  let parsed;\n  try {\n    parsed = JSON.parse(jsonString);\n  } catch (error) {\n    throw new Error('Invalid JSON format: ' + error.message);\n  }\n\n  // Flatten each priority group\n  for (const priority of Object.keys(parsed)) {\n    const articles = parsed[priority];\n    for (const article of articles) {\n      results.push({\n        Priority: priority,\n        Title: article.Title,\n        link: article.link,\n        summary: article.summary,\n        Vendor_Name: article[\"Vendor Name\"]\n      });\n    }\n  }\n}\n\n// Return each result as its own n8n item\nreturn results.map(r => ({ json: r }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3328,
        384
      ],
      "id": "c52acf2a-74c8-4874-b281-12791af1cbd2",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ycMbVsTwpzzdxGN1sULzoAtYmF7LABuP2BQY4AHB2F4",
          "mode": "list",
          "cachedResultName": "RSS Feed",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ycMbVsTwpzzdxGN1sULzoAtYmF7LABuP2BQY4AHB2F4/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ycMbVsTwpzzdxGN1sULzoAtYmF7LABuP2BQY4AHB2F4/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Title": "={{ $json.Title }}",
            "Priority": "={{ $json.Priority }}",
            "Link": "={{ $json.link }}",
            "Vendor Name": "={{ $json.Vendor_Name }}",
            "Summary": "={{ $json.summary }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Title",
              "displayName": "Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Priority",
              "displayName": "Priority",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Link",
              "displayName": "Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Vendor Name",
              "displayName": "Vendor Name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Summary",
              "displayName": "Summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3536,
        384
      ],
      "id": "a83f52ab-5f5f-4447-a3e6-a7945f959ac0",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "oDlfKzLprUWw3P92",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Merge": {
      "main": [
        [
          {
            "node": "Cleaning up the code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Formatting the Content for Mail",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Format the Summary for Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vendor URLs": {
      "main": [
        [
          {
            "node": "Splitting the Urls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Check the headers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Daily Trigger": {
      "main": [
        [
          {
            "node": "Vendor URLs",
            "type": "main",
            "index": 0
          },
          {
            "node": "RSS Feed List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RSS Feed List": {
      "main": [
        [
          {
            "node": "Splitting the Feeds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort the feeds": {
      "main": [
        [
          {
            "node": "Merge the content for AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check the headers": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Scrapping inside the Webpage content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Splitting the Urls": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Splitting the Feeds": {
      "main": [
        [
          {
            "node": "Vendor RSS Feed Read",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cleaning up the code": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Vendor RSS Feed Read": {
      "main": [
        [
          {
            "node": "Filtering last 24hrs feed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Merge the content for AI": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtering last 24hrs feed": {
      "main": [
        [
          {
            "node": "Sort the feeds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Format the Summary for Email": {
      "main": [
        [
          {
            "node": "Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatting the Content for Mail": {
      "main": [
        [
          {
            "node": "Gmail1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scrapping inside the Webpage content": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Gmail1": {
      "main": [
        []
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ed8890d2-7c5b-4522-b922-50b598cce597",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "3dce95668c598f6d0f9da090194a9974b22afc001733834edfd3cbd3f84e9927"
  },
  "id": "ty8dIDe6Fn616OAA",
  "tags": []
}