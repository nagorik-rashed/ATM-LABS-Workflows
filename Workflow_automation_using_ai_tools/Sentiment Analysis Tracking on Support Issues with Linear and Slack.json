{
  "name": "Sentiment_analysis_issue_tracked_workflow",
  "nodes": [
    {
      "parameters": {
        "fieldToSplitOut": "data.issues.nodes",
        "options": {}
      },
      "id": "1e8932f6-be4a-49b7-8c54-9554f2d219df",
      "name": "Issues to List",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -1920,
        -64
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "211e1041-da18-46e4-afe7-afb996d9a60d",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        -1600,
        128
      ],
      "typeVersion": 1,
      "credentials": {
        "openAiApi": {
          "id": "fVZUSiD0V6g24UAt",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{\n{\n ...$('Issues to List').item.json,\n ...$json.output\n}\n}}",
        "options": {}
      },
      "id": "aafcc90d-0aa8-4e77-acc9-cf775128ac2c",
      "name": "Combine Sentiment Analysis",
      "type": "n8n-nodes-base.set",
      "position": [
        -1248,
        -48
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "text": "={{ $json.comments.nodes.length ? $json.comments.nodes.map(node => [ `${node.user.displayName} commented on ${node.createdAt}:`, node.body ].join('\\n')).join('---\\n') : 'No comments available.' }}",
        "attributes": {
          "attributes": [
            {
              "name": "sentiment",
              "description": "One of positive, negative or neutral",
              "required": true
            },
            {
              "name": "sentimentSummary",
              "description": "Describe the sentiment of the conversation"
            }
          ]
        },
        "options": {}
      },
      "id": "0e08ad1b-9df8-4a77-91f0-916af1a87152",
      "name": "Sentiment over Issue Comments",
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "position": [
        -1600,
        -48
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ $json }}",
        "options": {}
      },
      "id": "4dd2d5dc-182f-45ef-938e-abd9587583c8",
      "name": "Copy of Issue",
      "type": "n8n-nodes-base.set",
      "position": [
        -736,
        -16
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "aa894b3d-c95e-4868-82a7-38c3ec1cbdf3",
      "name": "For Each Issue...",
      "type": "n8n-nodes-base.splitInBatches",
      "position": [
        -928,
        -16
      ],
      "typeVersion": 3
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appHbioUApIn0L3OQ",
          "mode": "list",
          "cachedResultName": "sentiment_analysis_tracker",
          "cachedResultUrl": "https://airtable.com/appHbioUApIn0L3OQ"
        },
        "table": {
          "__rl": true,
          "value": "tblhO0sfRhKP6ibS8",
          "mode": "list",
          "cachedResultName": "Table 1",
          "cachedResultUrl": "https://airtable.com/appHbioUApIn0L3OQ/tblhO0sfRhKP6ibS8"
        },
        "filterByFormula": "={Issue ID} = '{{ $json.identifier || 'XYZ' }}'",
        "options": {}
      },
      "id": "b9426efc-3924-43ff-aa0b-473ab1d07e8b",
      "name": "Get Existing Sentiment",
      "type": "n8n-nodes-base.airtable",
      "position": [
        -576,
        -16
      ],
      "typeVersion": 2.1,
      "alwaysOutputData": true,
      "credentials": {
        "airtableTokenApi": {
          "id": "3PiZHhz62w3MtuIJ",
          "name": "Airtable Personal Access Token account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appHbioUApIn0L3OQ",
          "mode": "list",
          "cachedResultName": "sentiment_analysis_tracker",
          "cachedResultUrl": "https://airtable.com/appHbioUApIn0L3OQ"
        },
        "table": {
          "__rl": true,
          "value": "tblhO0sfRhKP6ibS8",
          "mode": "list",
          "cachedResultName": "Table 1",
          "cachedResultUrl": "https://airtable.com/appHbioUApIn0L3OQ/tblhO0sfRhKP6ibS8"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Issue ID": "={{ $('Copy of Issue').item.json.id }}",
            "id": "={{ $('Copy of Issue').item.json.identifier }}",
            "Previous Sentiment": "={{ !$json.isEmpty() ? $json['Current Sentiment'] : 'N/A' }}",
            "Current Sentiment": "={{ $('Copy of Issue').item.json.sentiment.toSentenceCase() }}",
            "Summary": "={{ $('Copy of Issue').item.json.sentimentSummary || '' }}",
            "Issue Updated": "={{ $('Copy of Issue').item.json.updatedAt }}",
            "Issue Created": "={{ $('Copy of Issue').item.json.createdAt }}",
            "Issue Title": "={{ $('Copy of Issue').item.json.title }}",
            "Assigned": "={{ $('Copy of Issue').item.json.assignee.name }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Issue ID",
              "displayName": "Issue ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Previous Sentiment",
              "displayName": "Previous Sentiment",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Positive",
                  "value": "Positive"
                },
                {
                  "name": "Negative",
                  "value": "Negative"
                },
                {
                  "name": "Neutral",
                  "value": "Neutral"
                },
                {
                  "name": "N/A",
                  "value": "N/A"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Current Sentiment",
              "displayName": "Current Sentiment",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Positive",
                  "value": "Positive"
                },
                {
                  "name": "Negative",
                  "value": "Negative"
                },
                {
                  "name": "Neutral",
                  "value": "Neutral"
                },
                {
                  "name": "N/A",
                  "value": "N/A"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Summary",
              "displayName": "Summary",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Issue Title",
              "displayName": "Issue Title",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Issue Created",
              "displayName": "Issue Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Issue Updated",
              "displayName": "Issue Updated",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Assigned",
              "displayName": "Assigned",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "d58b5e9d-7a7c-4cea-96ec-5e57a4a259d4",
      "name": "Update Row",
      "type": "n8n-nodes-base.airtable",
      "position": [
        -400,
        -16
      ],
      "typeVersion": 2.1,
      "credentials": {
        "airtableTokenApi": {
          "id": "3PiZHhz62w3MtuIJ",
          "name": "Airtable Personal Access Token account 2"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyHour"
            }
          ]
        },
        "authentication": "airtableTokenApi",
        "baseId": {
          "__rl": true,
          "value": "appHbioUApIn0L3OQ",
          "mode": "id"
        },
        "tableId": {
          "__rl": true,
          "value": "tblhO0sfRhKP6ibS8",
          "mode": "id"
        },
        "triggerField": "Current Sentiment",
        "additionalFields": {}
      },
      "id": "20e91550-147c-4f13-a3a4-b471b2e6f776",
      "name": "Airtable Trigger",
      "type": "n8n-nodes-base.airtableTrigger",
      "position": [
        -48,
        0
      ],
      "typeVersion": 1,
      "credentials": {
        "airtableTokenApi": {
          "id": "3PiZHhz62w3MtuIJ",
          "name": "Airtable Personal Access Token account 2"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.fields[\"Previous Sentiment\"] !== 'Negative' && $json.fields[\"Current Sentiment\"] === 'Negative' }}",
                    "rightValue": ""
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "NON-NEGATIVE to NEGATIVE"
            }
          ]
        },
        "options": {
          "fallbackOutput": "none"
        }
      },
      "id": "77fa8770-7c6f-40b0-ac7a-9f6e3ac8b530",
      "name": "Sentiment Transition",
      "type": "n8n-nodes-base.switch",
      "position": [
        128,
        0
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "endpoint": "https://api.linear.app/graphql",
        "requestFormat": "json",
        "query": "=query (\n $filter: IssueFilter\n) {\n issues(\n filter: $filter\n ) {\n nodes {\n id\n identifier\n title\n description\n url\n createdAt\n updatedAt\n assignee {\n name\n }\n comments {\n nodes {\n id\n createdAt\n user {\n displayName\n }\n body\n }\n }\n }\n }\n}",
        "variables": "={{\n{\n \"filter\": {\n updatedAt: { gte: $now.minus(100, 'minutes').toISO() }\n }\n}\n}}"
      },
      "id": "0039572a-9e4c-4ee2-9e0c-723d989da578",
      "name": "Fetch Active Linear Issues",
      "type": "n8n-nodes-base.graphql",
      "position": [
        -2096,
        -64
      ],
      "typeVersion": 1,
      "credentials": {
        "httpHeaderAuth": {
          "id": "n9NBWVI6dLLWhe7N",
          "name": "Header Auth account 3"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 30
            }
          ]
        }
      },
      "id": "cdf3f219-6581-4e05-84b1-896ab3c462ac",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -2288,
        -64
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "operation": "removeItemsSeenInPreviousExecutions",
        "dedupeValue": "={{ $json.fields[\"Issue ID\"] }}:{{ $json.fields['Last Modified'] }}",
        "options": {}
      },
      "id": "99312f34-93f6-438d-b221-3e29563a18ee",
      "name": "Deduplicate Notifications",
      "type": "n8n-nodes-base.removeDuplicates",
      "position": [
        336,
        0
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "content": "## 1. Continuously Monitor Active Linear Issues\n[Learn more about the GraphQL node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.graphql)\n\nTo keep up with the latest changes in our active Linear tickets, we'll need to use Linear's GraphQL endpoint because filtering is currently unavailable in the official Linear.app node.\n\nFor this demonstration, we'll check for updated tickets every 30mins.",
        "height": 440,
        "width": 660,
        "color": 7
      },
      "id": "0d5ae2ab-6cae-4eab-bcf4-66a2c84fb9d4",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2368,
        -288
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 2. Sentiment Analysis on Current Issue Activity\n[Learn more about the Information Extractor node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.information-extractor)\n\nWith our recently updated posts, we can use our AI to perform a quick sentiment analysis on the ongoing conversation to check the overall mood of the support issue. This is a great way to check how things are generally going in the support queue; positive should be normal but negative could indicate some uncomfortableness or even frustration.",
        "height": 560,
        "width": 640,
        "color": 7
      },
      "id": "8ef8c259-921e-4287-b20b-2f8d5136ee37",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1696,
        -288
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 3. Capture and Track Results in Airtable\n[Learn more about the Airtable node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.airtable)\n\nNext, we can capture this analysis in our insights database as means for human review. When the issue is new, we can create a new row but if the issue exists, we will update it's existing row instead.\n\nWhen updating an existing row, we move its previous \"current sentiment\" value into the \"previous sentiment\" column and replace with our new current sentiment. This gives us a \"sentiment transition\" which will be useful in the next step.\n\nCheck out the Airtable here: https://airtable.com/appViDaeaFw4qv9La/shrq6HgeYzpW6uwXL",
        "height": 560,
        "width": 840,
        "color": 7
      },
      "id": "72212181-d699-479b-a859-0fe4cc19e593",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1040,
        -288
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 4. Get Notified when Sentiment becomes Negative\n[Learn more about the Slack node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.slack/)\n\nA good use-case for tracking sentiment transitions could be to be alerted if ever an issue moves from a non-negative sentiment to a negative one. This could be a signal of issue handling troubles which may require attention before it escalates.\n\nIn this demonstration, we use the Airtable trigger to catch rows which have their sentiment column updated and check for the non-negative-to-negative sentiment transition using the switch node. For those matching rows, we combine add send a notification via slack. A cool trick is to use the \"remove duplication\" node to prevent repeat notifications for the same updates - here we combine the Linear issue key and the row's last modified date.",
        "height": 560,
        "width": 920,
        "color": 7
      },
      "id": "ee5b21eb-4560-45e1-ad7c-c15ac246d5ff",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -160,
        -288
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Try It Out!\n### This n8n template performs continous monitoring on Linear Issue conversations performing sentiment analysis and alerting when the sentiment becomes negative.\nThis is helpful to quickly identify difficult customer support situations early and prioritising them before they get out of hand.\n\n## How it works\n* A scheduled trigger is used to fetch recently updated issues in Linear using the GraphQL node.\n* Each issue's comments thread is passed into a simple Information Extractor node to identify the overall sentiment.\n* The resulting sentiment analysis combined with the some issue details are uploaded to Airtable for review.\n* When the template is re-run at a later date, each issue is re-analysed for sentiment\n* Each issue's new sentiment state is saved to the airtable whilst its previous state is moved to the \"previous sentiment\" column.\n* An Airtable trigger is used to watch for recently updated rows\n* Each matching Airtable row is filtered to check if it has a previous non-negative state but now has a negative state in its current sentiment.\n* The results are sent via notification to a team slack channel for priority.\n\n**Check out the sample Airtable here**: https://airtable.com/appViDaeaFw4qv9La/shrq6HgeYzpW6uwXL\n\n## How to use\n* Modify the GraphQL filter to fetch issues to a relevant issue type, team or person.\n* Update the Slack channel to ensure messages are sent to the correct location.\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\n\nHappy Hacking!",
        "height": 840,
        "width": 480
      },
      "id": "85b83ca5-87c1-4d5a-80a4-ec629dfc6bc4",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2896,
        -688
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "chatId": "7493883462",
        "text": "=Issue ID: {{ $json.fields['Issue ID'] }}\nCurrent Sentiment: {{ $json.fields['Current Sentiment'] }}\nIssue summary: {{ $json.fields.Summary }}\nIssue Title: {{ $json.fields['Issue Title'] }}\nIssue Created: {{ $json.fields['Issue Created'] }}\nIssue Updated: {{ $json.fields['Issue Updated'] }}\nIssue Modified: {{ $json.fields['Last Modified'] }}\nPrevious Sentiment: {{ $json.fields['Previous Sentiment'] }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        544,
        0
      ],
      "id": "e7d632b7-3dca-493c-aa44-6dfc5c4caa62",
      "name": "Send a text message",
      "webhookId": "790820fb-5bc6-43eb-b5c5-750f7e38bd1b",
      "credentials": {
        "telegramApi": {
          "id": "wz0PpDwYHUjN9Nsi",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Update Row": {
      "main": [
        [
          {
            "node": "For Each Issue...",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Copy of Issue": {
      "main": [
        [
          {
            "node": "Get Existing Sentiment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Issues to List": {
      "main": [
        [
          {
            "node": "Sentiment over Issue Comments",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable Trigger": {
      "main": [
        [
          {
            "node": "Sentiment Transition",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Fetch Active Linear Issues",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "For Each Issue...": {
      "main": [
        [],
        [
          {
            "node": "Copy of Issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Sentiment over Issue Comments",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Sentiment Transition": {
      "main": [
        [
          {
            "node": "Deduplicate Notifications",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Existing Sentiment": {
      "main": [
        [
          {
            "node": "Update Row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deduplicate Notifications": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine Sentiment Analysis": {
      "main": [
        [
          {
            "node": "For Each Issue...",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Active Linear Issues": {
      "main": [
        [
          {
            "node": "Issues to List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sentiment over Issue Comments": {
      "main": [
        [
          {
            "node": "Combine Sentiment Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d4f32ac2-1486-4fc0-b9c8-9f75bfa34f82",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "8d401f885e1d55f4ab54b9409be28c0a99616546f3fde5dcc217c9802d0a05db"
  },
  "id": "KegVtSQLNXNBJcPW",
  "tags": []
}